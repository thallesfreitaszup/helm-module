package main

import (
	"context"
	"encoding/json"
	"fmt"
	"github.com/dgraph-io/ristretto/z"
	"github.com/hashicorp/go-getter"
	"github.com/thallesfreitaszup/helm-module/helm"
	"log"
	"os"
	"path/filepath"
	"strconv"
)

func main() {
	pwd, _ := os.Getwd()
	getter := getter.Client{
		Ctx:  context.TODO(),
		Pwd:  pwd,
		Src:  "git::git@gitlab.com:thalleslmf/event-receiver.git//event-receiver?ref=main&sshkey=LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQ21GbGN6STFOaTFqZEhJQUFBQUdZbU55ZVhCMEFBQUFHQUFBQUJDK0NRRTVMNQpSbUZrK2RVdUhVQlBkT0FBQUFFQUFBQUFFQUFBRVhBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCQVFEWGdNbzZDK1dnCnE3bzA4ejhmTXIvRWJzSTdLeWlkazNYWVlsR2tkQ0lXelBYdFQ3RHVTNHE3ampSZXNDQnpBUXJFbWRXemg4VjZDWmdBSkUKeGNvWklmNUVpWTNKalRRclNFdFNqQUhxTU1TU1RHRmhIWUVjbnZwR25CV0JFY3E2NlY1TG5mWGJ5VEhBck5FdkU2NG5NRQp1N3UwNTJQdkEyVWVEeUs3ZElXLzBhRG1XWVpXSjRISXN2c2xVc05WZDFPRk5BVHRSQ2IvYk83MG5LaGpXTUlvbVNGOVBLCnNtTXRWNFM5MjVJY0dSa21kd1BGa2F5QmJXM1JBNldMVmlydU9EMUJCKzlwZENNTUkrSzRud2Fkb05mODFJZ1dLTSs3L2kKeUczY1BmSFh1emJoREljWkpKUERGdWtraDFocm94Yk1UbUxOUjAzTFc5RVFZTkp4b05mL0FBQUR3UEV1UnEyUWQrb0dJMgpMSHNMdUI1aWRoS3R6Y1A0eWJ1ZlpzcFZFN3ZZV2ZrME1GTG8wai9PWDVvVXo3eFNrZnh2bmNTWUJtL3dzakhnbFphZlJkCnh6dklLcU96WWRNd2JtQkxrMmNWMnkrMGQyU1RzeWE0WFg1VmROQVg5bHo3MWduTVh5WVljWEZ1WEkvQWlkNVIreWhPODgKcnpvMVB6Y2c4RXlwOThsbndVUEk5dFJsN0JqVUxjc1lNK2t6bllQSmR1MWx3RENWenJteU5iNmtXVnc5ZjFBVzlCaDJ1NwpwTVR1eTVPcFRVV3VjV29jWENTRG9hM05wc0NkZkVTQlRKK1E5WGdHNHFiWUxLMnBjNCt6QnNMemVUOGhVU1puZmZndnVSClBmS25UTTh6S2QvdTJLQldrM0xzNktUbjZRL2xhRm9GcjNYb1BSZnEwa05JUUZnTlloQTZuRmczaUROc1l4UEdjNlVUaksKK0ZZaUpOeXhFejA5SlNsenVUUk5Dbkk3ODY0MTY4bytnNmplL3dPZDZyd3F0bmZjbE16K29lWi9lYTdkQmd4WkdIRkhmZgpWZTZJZEV2cWo5QWxpWDByYTMzdEZHYlRkV3RtZlZqVnZqcVJVQWp2bGlQZGU5cWtNZXdJRVpBbHBLUFdrR3JZaEczbDI4CnppOGw1TkdqQlV4WUd0L2RjYmQrWXo3QlcxVEpKdXNpUGxkbEJiU3gyMXU0MzdIYVdsMXBhSS9mbmptcjc3T3h0dVo4VWoKMXV1Nkc0YUcwUVd5MWFqU3FsZ0lNeTM4NmtZSy81YStidmZBTjJ1ZnEyaWwwMGtYNzZTMnU4TDVaem80c1JrcUc2bFdmZgorTHVhZFVBWEVjTHJSUUlxV1lWT1ZCVGJ1aThrN3FFZllaZEZ0cnZSQXBveE4zR2I1bkczdE9McUcrdDU1alFPci9XaXQwCkxCYk43T01QWWlmS2F6aE4rVFV3WmtVZVBLU2t0RndYbUhTVW8weXkyQWVvWHpzY0FyQzVvVTZsajlNUXFLL2gyalJ4N1gKYm9odjd5MXdLMFhEcnhOVzAzdzkzaUUvMVFkWmRwKzVEaVhYYUNYZVBvV0dMVHU0YlVtV2FoMXMwMmFRNzkvWnpEUHhBTwpGbkxkRWNJM1RpOWZLUVNTcUVrM2lKR0Q1QVVOMlVQZGdKcGx5dTRISDM5d3UwRkFMcklkUkFiUVJkZjlZMllZWEhscTVQCkxQUU1kZUQ4UStsOW1xdzhnRGY0cVdCVGdLdjZvOWNVQ3l1SlAvNjNHa2JYL0FMN2RoNU9IVkhJYm1scWlLd29ST3oxTHAKT3NsMWxPNFNzWjFmbVlxK21lVmZuVzJUYS9lTmtVSUE4ZFY1d0lpTnRMc0lnK2liQVFTZ01rQ0xTYk1HMWZRL2V3Z3BDRQpsL0ZKdHlKM3VjYUtVcDJubjU3bC9ITHZsMy91K1hMS2wwbmJzMW9qd01sM1VvSnA3NEg3TUtCd0s0azdKSG5yZDljVmJpCmNQTCtudFlhVFQ4ZlFRajVKS2QwekttTXdONHQyQ0czNkdyT0xzTU1NMUxoQ0sza2pYM2ZhS2dFQXJ3WnBpdUN2cVlHWjAKMS9HTWpGcXJMYUg3Wk5jQXg2ZHJMZ2ZYNzk2MmlhbjN2b21WWUMxWXVXMGgvWW1BdVozZStzRzNpdHFIKzJzMkdlSXlNNwppUk9iRk94Zz09Ci0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQ==",
		Dst:  filepath.Join(os.TempDir(), "helm"+strconv.Itoa(int(z.FastRand()))),
		Mode: getter.ClientModeAny,
	}
	h := helm.New(getter.Src, &getter, helm.Options{}, getter.Dst)
	manifests, err := h.Render()
	if err != nil {
		log.Fatal(err)
	}
	manifestBytes, _ := json.Marshal(manifests)
	fmt.Println(string(manifestBytes))
}
